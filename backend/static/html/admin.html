<body>
    <h1>ğŸ”§ ê´€ë¦¬ì í˜ì´ì§€</h1>
  
    <div>
      <h2>ì‚¬ìš©ì ëª©ë¡</h2>
      <form id="admin-form">
        <table>
          <thead>
            <tr>
              <th>ì‚¬ìš©ì</th>
              <th>ìŠ¹ì¸</th>
              <th>ê´€ë¦¬ì</th>
            </tr>
          </thead>
          <tbody>
            {user_table}
          </tbody>
        </table>
  
        <h2>ê¸°ë³¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ í˜ì´ì§€</h2>
        <input type="text" name="redirect_target" value="{redirect_page}" />
        <br><br>
        <button type="submit" id="saveBtn">ğŸ’¾ ì €ì¥</button>
      </form>
    </div>
  
    <script>
      document.getElementById("admin-form").addEventListener("submit", async (e) => {
        e.preventDefault();
  
        const users = Array.from(document.querySelectorAll("tr[data-username]"))
        .map(row => {
          const username = row.dataset.username;
          const isAuthorized = row.querySelector(".auth")?.checked || false;
          return { username, is_authorized: isAuthorized };
        });

        const redirect_page = document.querySelector("input[name='redirect_target']").value.trim();
  
        const res = await fetch("/api/admin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ users, redirect_page }),
        });
  
        if (res.ok) {
          alert("ì €ì¥ ì™„ë£Œ!");
        } else {
          alert("ì €ì¥ ì‹¤íŒ¨");
        }
      });
    </script>
  </body>